# Guide d'installation complète : PHP, Composer et TailPress avec DevKinsta

Ce guide documente l'installation complète de PHP, Composer, TailPress et l'automatisation DevKinsta sur Windows.

## Prérequis

- Windows 10/11
- DevKinsta installé et fonctionnel
- Docker Desktop (WSL2 activé)
- Node.js installé (v24.11.0 ou supérieur)
- Composer installé
- PHP CLI disponible (par ex. `C:\\php\\php.exe`)

---

## 1. Installation de PHP sur Windows

### 1.1 Télécharger PHP

1. Aller sur https://windows.php.net/download/
2. Télécharger **PHP 8.3 (ou 8.5) VS16/VS17 x64 Non Thread Safe (NTS)** - version **Zip**
3. Extraire le contenu du ZIP dans `C:\\php`

### 1.2 Ajouter PHP au PATH Windows

1. Ouvrir "Variables d'environnement" (rechercher dans le menu Démarrer)
2. Dans "Variables système", cliquer sur **Path** puis **Modifier**
3. Cliquer **Nouveau** et ajouter : `C:\\php`
4. Valider avec **OK** partout
5. **Redémarrer PowerShell**

### 1.3 Vérifier l'installation de PHP

```powershell
php -v
```

Vous devriez voir quelque chose comme :

```text
PHP 8.5.0 (cli) (built: Nov 19 2025 09:56:40) (NTS Visual C++ 2022 x64)
```

---

## 2. Installation de Composer

### 2.1 Télécharger l'installateur Composer

1. Télécharger : https://getcomposer.org/Composer-Setup.exe
2. Exécuter l'installateur

### 2.2 Configuration de l'installateur

1. Quand l'installateur demande "Choose your command line PHP", cliquer sur **Browse**
2. Sélectionner `C:\\php\\php.exe`
3. Choisir le **mode développeur (Developer mode)**
4. Laisser l'installateur terminer

### 2.3 Vérifier l'installation de Composer

Après redémarrage de PowerShell :

```powershell
composer --version
```

Exemple :

```text
Composer version 2.9.2 2025-11-19 21:57:25
PHP version 8.5.0 (C:\\php\\php.exe)
```

---

## 3. Politique d'exécution PowerShell

Pour permettre l'exécution de scripts npm :

```powershell
# PowerShell lancé en tant qu'administrateur
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

Répondre **Y** lorsqu'on vous le demande.

---

## 4. Mapping DevKinsta (WSL) sur un lecteur Windows

Les chemins UNC (`\\wsl.localhost\\...`) posent problème pour npm. On mappe donc sur `Z:` :

```powershell
net use Z: \\wsl.localhost\docker-desktop-data
```

DevKinsta place les sites ici :

```text
Z:\data\docker\volumes\DevKinsta\public\<nom-du-site>
```

En cas de redémarrage de Windows, remapper avec la même commande.

---

## 5. Installation de TailPress dans un site DevKinsta

Exemple avec un site DevKinsta nommé `tailpress` :

```powershell
cd Z:\data\docker\volumes\DevKinsta\public\tailpress\wp-content\themes\tailpress
```

### 5.1 Installer les dépendances npm

```powershell
npm install
```

### 5.2 Compiler les assets (production)

```powershell
npm run build
```

Cela génère :

- `dist/.vite/manifest.json`
- `dist/assets/app-XXXX.css`
- `dist/assets/app-XXXX.js`

### 5.3 Vérifier le dossier dist

```powershell
ls dist
```

Vous devriez voir les fichiers `app-*.css` et `app-*.js` dans `dist/assets/`.

---

## 6. Activer TailPress dans WordPress (DevKinsta)

1. Ouvrir l'admin : `https://<site>.local/wp-admin`
2. Aller dans **Apparence > Thèmes**
3. Activer le thème **TailPress**

Assurez-vous que les assets (`dist/`) existent avant d'activer le thème.

---

## 7. Automatisation PowerShell DevKinsta

Pour éviter de répéter les mêmes commandes, on utilise un **profil PowerShell** global.

### 7.1 Emplacement du profil

```text
C:\Users\<Utilisateur>\OneDrive\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1
```

Sur la machine de référence :

```text
C:\Users\olivi\OneDrive\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1
```

Ce profil :

- Ajoute `C:\php` au `PATH`
- Monte automatiquement `Z:` sur `\\wsl.localhost\docker-desktop-data`
- Convertit les chemins UNC vers `Z:`
- Détecte un projet DevKinsta (présence de `wp-content`, `themes`, `package.json`, `vite.config.*`, `composer.json`)
- Détecte TailPress / Tailwind / Composer
- Fournit des commandes pratiques :
  - `devkinsta-status`
  - `devkinsta-build`
  - `devkinsta-dev`
  - `devkinsta-help`

> Pour une nouvelle machine, il suffit de **copier ce fichier** au même emplacement pour retrouver ces commandes.

### 7.2 Commandes disponibles

- `devkinsta-status`
  - Vérifie : Z:, Node, npm, Composer, PHP
  - Détecte le projet WP/TailPress

- `devkinsta-build`
  - Dans le thème actif :
    - `composer install` si `vendor/` manquant
    - `npm install` si `node_modules/` manquant
    - `npm run build` (Vite/TailPress)

- `devkinsta-dev`
  - Dans le thème actif :
    - `npm install` si besoin
    - `npm run dev` (serveur Vite ou script `watch`)

- `devkinsta-help`
  - Récapitulatif des commandes.

---

## 8. Intégration Windsurf / VS Code

Dans la racine du site DevKinsta :

```text
Z:\data\docker\volumes\DevKinsta\public\<site>\.vscode\
```

### 8.1 `.vscode/settings.json`

- Définit PowerShell comme terminal par défaut.
- Définit le **cwd** du terminal sur la racine du projet.
- Charge le profil PowerShell avec `-NoExit -Command ". $PROFILE"`.
- Configure :
  - `php.validate.executablePath` (`C:\\php\\php.exe`)
  - IntelliSense Tailwind CSS pour les fichiers PHP.

### 8.2 `.vscode/tasks.json`

Tâches typiques :

- `DevKinsta: Status` → `. $PROFILE; devkinsta-status`
- `DevKinsta: Full Build` → `. $PROFILE; devkinsta-build`
- `DevKinsta: Dev Server` → `. $PROFILE; devkinsta-dev`

Ainsi que des tâches directes `npm install`, `npm run build`, `composer install` dans le thème.

Sur une nouvelle machine, copier `.vscode/` et ajuster si besoin le chemin vers PHP.

---

## 9. Workflow complet sur une nouvelle machine

1. Installer : PHP (`C:\\php`), Composer, Node, DevKinsta, Docker (WSL2).
2. Copier le profil PowerShell dans :

   ```text
   C:\Users\<Utilisateur>\OneDrive\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1
   ```

3. Ouvrir Windsurf sur le site DevKinsta monté :

   ```text
   Z:\data\docker\volumes\DevKinsta\public\<site>
   ```

4. Copier :
   - le thème TailPress complet (`wp-content/themes/tailpress`)
   - le dossier `.vscode/`

5. Dans le terminal :

   ```powershell
   devkinsta-status
   devkinsta-build
   # pour le dev
   devkinsta-dev
   ```

6. Ouvrir `https://<site>.local/` dans le navigateur (DevKinsta) et développer.

---

## 10. Résumé

- PHP + Composer gèrent les dépendances backend (TailPress Framework, etc.).
- Node + npm + Vite gèrent Tailwind CSS et les assets JS.
- DevKinsta fournit l'environnement WordPress via Docker + WSL2.
- Un profil PowerShell centralise le montage de Z:, la détection DevKinsta et les commandes `devkinsta-*`.
- `.vscode/` fournit une intégration propre avec Windsurf / VS Code.

Ce guide + le profil PowerShell + le thème TailPress + le dossier `.vscode` suffisent pour **recréer le même environnement** sur une autre machine Windows.
